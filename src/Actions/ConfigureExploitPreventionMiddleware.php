<?php

namespace Motomedialab\Stub\Actions;

use Illuminate\Support\Str;

class ConfigureExploitPreventionMiddleware
{
    public function __invoke(): void
    {
        $kernelPath = app_path('Http/Kernel.php');
        $appConfig = file_get_contents($kernelPath);

        if (!Str::contains($appConfig, 'App\Http\Middleware\ExploitPreventionMiddleware.php')) {
            file_put_contents(
                $kernelPath,
                str_replace(
                    '\App\Http\Middleware\VerifyCsrfToken::class,',
                    "\App\Http\Middleware\ExploitPreventionMiddleware.php,"
                    . PHP_EOL . '        \App\Http\Middleware\VerifyCsrfToken::class,',
                    $appConfig,
                )
            );
        }
    }
}